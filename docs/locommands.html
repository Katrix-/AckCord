<html><head><title>AckCord: Low level API commands</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Katrix" /><meta name="description" content="A Scala Discord library" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="AckCord: Low level API commands" /><meta name="title" property="og:title" content="AckCord: Low level API commands" /><meta name="og:site_name" content="AckCord" /><meta name="og:url" content="http://ackcord.katsstuff.net" /><meta name="og:type" content="website" /><meta name="og:description" content="A Scala Discord library" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="AckCord: Low level API commands" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="A Scala Discord library" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>AckCord</span></div></a></li> <li><a href="/getting_started.html" class="">Getting Started</a></li> <li><a href="/docs/cachesnapshot.html" class="">Shared concepts</a> <ul class="sub_section"> <li><a href="/docs/cachesnapshot.html" class="">CacheSnapshot</a></li> <li><a href="/docs/sharedcommands.html" class="">Shared command concepts</a></li></ul></li> <li><a href="/docs/requests.html" class="">Making Requests</a></li> <li><a href="/docs/cache.html" class="">The cache (Advanced)</a></li> <li><a href="/docs/sound.html" class="">Sending custom sound (Advanced)</a></li> <li><a href="/docs/hicommands.html" class="">High level API commands</a></li> <li><a href="/docs/locommands.html" class=" active ">Low level API commands</a></li> <li><a href="/docs/newcommands.html" class="">New incubating commands</a></li> <li><a href="/modules.html" class="">The many modules of AckCord</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="Katrix" data-github-repo="AckCord"><div class="content-wrapper"><section><h1 id="low-level-api-commands">Low level API commands</h1>

<p>If you want to work with commands from the low level API, you have to add a dependency on the commands module. Before reading this, make sure you understand the shared command concepts.</p>

<p>As before we create out client as usual. Note the extra import for the commands package.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ackcord._</span>
<span class="k">import</span> <span class="nn">ackcord.data._</span>
<span class="k">import</span> <span class="nn">ackcord.syntax._</span>
<span class="k">import</span> <span class="nn">ackcord.commands._</span>
<span class="k">import</span> <span class="nn">akka.NotUsed</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.stream.scaladsl.</span><span class="o">{</span><span class="nc">Source</span><span class="o">,</span> <span class="nc">Flow</span><span class="o">,</span> <span class="nc">Keep</span><span class="o">}</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span>  <span class="o">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"AckCord"</span><span class="o">)</span>
<span class="k">import</span> <span class="nn">system.dispatcher</span>

<span class="k">val</span> <span class="n">token</span> <span class="k">=</span> <span class="s">"&lt;token&gt;"</span>
<span class="k">val</span> <span class="n">cache</span> <span class="k">=</span> <span class="nc">Cache</span><span class="o">.</span><span class="n">create</span>
<span class="k">val</span> <span class="n">requests</span> <span class="k">=</span> <span class="nc">RequestHelper</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">BotAuthentication</span><span class="o">(</span><span class="n">token</span><span class="o">))</span>

<span class="k">val</span> <span class="n">gatewaySettings</span> <span class="k">=</span> <span class="nc">GatewaySettings</span><span class="o">(</span><span class="n">token</span><span class="o">)</span>
<span class="nc">DiscordShard</span><span class="o">.</span><span class="n">fetchWsGateway</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">wsUri</span> <span class="k">=&gt;</span>
 <span class="k">val</span> <span class="n">shard</span> <span class="k">=</span> <span class="nc">DiscordShard</span><span class="o">.</span><span class="n">connect</span><span class="o">(</span><span class="n">wsUri</span><span class="o">,</span> <span class="n">gatewaySettings</span><span class="o">,</span> <span class="n">cache</span><span class="o">,</span> <span class="s">"DiscordShard"</span><span class="o">)</span>
 <span class="c1">//shard ! DiscordShard.StartShard
</span><span class="o">}</span>
</code></pre>
</div>

<h2 id="the-commands-object">The Commands object</h2>

<p>Just like the job of the <code class="highlighter-rouge">Cache</code> object is to keep track of the current events and state of the application, it’s the job of the <code class="highlighter-rouge">Commands</code> object to keep track of the current commands in the application. To get a <code class="highlighter-rouge">Commands</code> instance, call <code class="highlighter-rouge">CoreCommands.create</code>. From there you have access to a source of raw commands that can be materialized as many times as needed.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="nc">GeneralCommands</span> <span class="k">=</span> <span class="s">"!"</span>
<span class="k">val</span> <span class="n">commands</span> <span class="k">=</span> <span class="nc">CoreCommands</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="nc">CommandSettings</span><span class="o">(</span><span class="n">prefixes</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="nc">GeneralCommands</span><span class="o">),</span> <span class="n">needsMention</span> <span class="k">=</span> <span class="kc">true</span><span class="o">),</span> <span class="n">cache</span><span class="o">,</span> <span class="n">requests</span><span class="o">)</span>
</code></pre>
</div>

<p>Let’s create a raw command, using the <code class="highlighter-rouge">Source</code> found the the <code class="highlighter-rouge">Commands</code> object.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">rawCommandEcho</span> <span class="k">=</span> <span class="nc">Flow</span><span class="o">[</span><span class="kt">RawCmdMessage</span><span class="o">].</span><span class="n">collect</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">RawCmd</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span> <span class="nc">GeneralCommands</span><span class="o">,</span> <span class="s">"echo"</span><span class="o">,</span> <span class="n">args</span><span class="o">,</span> <span class="n">c</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="k">implicit</span> <span class="k">val</span> <span class="n">cache</span><span class="k">:</span> <span class="kt">CacheSnapshot</span> <span class="o">=</span> <span class="n">c</span>
    <span class="nc">Source</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="n">tGuildChannel</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">sendMessage</span><span class="o">(</span><span class="n">s</span><span class="s">"ECHO: ${args.mkString("</span> <span class="s">")}"</span><span class="o">)).</span><span class="n">toList</span><span class="o">)</span>
<span class="o">}.</span><span class="n">flatMapConcat</span><span class="o">(</span><span class="n">identity</span><span class="o">).</span><span class="n">to</span><span class="o">(</span><span class="n">requests</span><span class="o">.</span><span class="n">sinkIgnore</span><span class="o">)</span>

<span class="n">commands</span><span class="o">.</span><span class="n">subscribeRaw</span><span class="o">.</span><span class="n">to</span><span class="o">(</span><span class="n">rawCommandEcho</span><span class="o">).</span><span class="n">run</span><span class="o">()</span>
<span class="c1">// res1: NotUsed = NotUsed
</span></code></pre>
</div>

<h2 id="cmdfactory">CmdFactory</h2>

<p>Often times, working with the raw commands objects directly can be kind of tiresome and usually involves a lot of boilerplate. For that reason, Ackcord also provides several types of <code class="highlighter-rouge">CmdFactory</code> which will do the the job of selecting the right commands, possibly parsing it, running the code for the command, and more. You’ll choose a different factory type depending on if your command parses the arguments it receives or not. The factory also supplies extra information about the command, like an optional description and filters. We’ll go over each of these one by one.</p>

<h3 id="running-the-code">Running the code</h3>

<p>AckCord represents the code to run for a command as a Sink that can be connected to the command messages. While you can use the materialized value of running the sink, in most cases you probably only want use an ignoring sink as the last step of the pipeline.</p>

<h2 id="other-helpers">Other helpers</h2>

<p>There are a few more helpers that you can use when writing commands. The first one is <code class="highlighter-rouge">CmdFlow</code> and <code class="highlighter-rouge">ParsedCmdFlow[A]</code>, which helps you construct a flow with an implicit cache snapshot. The next is the <code class="highlighter-rouge">requestRunner</code> methods on the command factory objects, which lets you create factories that takes a <code class="highlighter-rouge">(RequestRunner[SourceRequest, F], &lt;cmdtype&gt;[F]) =&gt; SourceRequest[Unit]</code> instead.</p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>So now that we know what all the different things to, let’s create our factories.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">getUsernameCmdFactory</span> <span class="k">=</span> <span class="nc">ParsedCmdFactory</span><span class="o">.</span><span class="n">requestRunner</span><span class="o">[</span><span class="kt">User</span><span class="o">](</span>
  <span class="n">refiner</span> <span class="k">=</span> <span class="nc">CmdInfo</span><span class="o">(</span><span class="n">prefix</span> <span class="k">=</span> <span class="nc">GeneralCommands</span><span class="o">,</span> <span class="n">aliases</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"getUsername"</span><span class="o">)),</span>
  <span class="n">run</span> <span class="k">=</span> <span class="k">implicit</span> <span class="n">c</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">runner</span><span class="o">,</span> <span class="n">cmd</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
    <span class="k">import</span> <span class="nn">runner._</span>
    <span class="k">for</span> <span class="o">{</span>
      <span class="n">channel</span> <span class="k">&lt;-</span> <span class="n">optionPure</span><span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">tGuildChannel</span><span class="o">)</span>
      <span class="k">_</span>       <span class="k">&lt;-</span> <span class="n">run</span><span class="o">(</span><span class="n">channel</span><span class="o">.</span><span class="n">sendMessage</span><span class="o">(</span><span class="n">s</span><span class="s">"Username for user is: ${cmd.args.username}"</span><span class="o">))</span>
    <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
  <span class="o">},</span>
  <span class="n">description</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="nc">CmdDescription</span><span class="o">(</span><span class="n">name</span> <span class="k">=</span> <span class="s">"Get username"</span><span class="o">,</span> <span class="n">description</span> <span class="k">=</span> <span class="s">"Get the username of a user"</span><span class="o">))</span>
<span class="o">)</span>

<span class="n">commands</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="n">getUsernameCmdFactory</span><span class="o">)(</span><span class="nc">Keep</span><span class="o">.</span><span class="n">left</span><span class="o">)</span>
</code></pre>
</div>

<h2 id="help-command">Help command</h2>

<p>AckCord also provides the basics for a help command if you want something like that in the form of the abstract actor <code class="highlighter-rouge">HelpCmd</code>. You use it by sending <code class="highlighter-rouge">HelpCmd.AddCmd</code> with the factory for the command, and the lifetime of the command. You get the lifetime of the command as a result of registering the command.</p>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/js/main.js"></script></body></html>