<html><head><title>AckCord: CacheSnapshot</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Katrix" /><meta name="description" content="A Scala Discord library" /><meta name="og:image" content="/img/poster.png" /><meta name="image" property="og:image" content="/img/poster.png" /><meta name="og:title" content="AckCord: CacheSnapshot" /><meta name="title" property="og:title" content="AckCord: CacheSnapshot" /><meta name="og:site_name" content="AckCord" /><meta name="og:url" content="http://ackcord.katsstuff.net" /><meta name="og:type" content="website" /><meta name="og:description" content="A Scala Discord library" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="AckCord: CacheSnapshot" /><meta name="twitter:image" content="/img/poster.png" /><meta name="twitter:description" content="A Scala Discord library" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>AckCord</span></div></a></li> <li><a href="/getting_started.html" class="">Getting Started</a></li> <li><a href="/docs/cachesnapshot.html" class="">Shared concepts</a> <ul class="sub_section"> <li><a href="/docs/cachesnapshot.html" class=" active ">CacheSnapshot</a></li> <li><a href="/docs/sharedcommands.html" class="">Shared command concepts</a></li></ul></li> <li><a href="/docs/requests.html" class="">Making Requests</a></li> <li><a href="/docs/cache.html" class="">The cache (Advanced)</a></li> <li><a href="/docs/sound.html" class="">Sending custom sound (Advanced)</a></li> <li><a href="/docs/hicommands.html" class="">High level API commands</a></li> <li><a href="/docs/locommands.html" class="">Low level API commands</a></li> <li><a href="/docs/newcommands.html" class="">New incubating commands</a></li> <li><a href="/modules.html" class="">The many modules of AckCord</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/Katrix/AckCord"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="Katrix" data-github-repo="AckCord"><div class="content-wrapper"><section><h1 id="cachesnapshot">CacheSnapshot</h1>

<p>All access to data store in AckCord is represented as a <code class="highlighter-rouge">CacheSnapshot[F]</code> where <code class="highlighter-rouge">F</code> is some type constructor like <code class="highlighter-rouge">Future</code> or <code class="highlighter-rouge">Id</code> that represents how to access the data. For example, if you use some external cache, then if would be <code class="highlighter-rouge">Future</code>. The default in AckCord is <code class="highlighter-rouge">Id</code>, which means the cache is stored in memory. Many methods in AckCord takes an implicit cache to let you access stuff. Note that for access to some data, we need some typeclasses from cats (Monad, Functor, Applicative…) for the type <code class="highlighter-rouge">F</code>.</p>

<p>AckCord also provides the <code class="highlighter-rouge">Streamable</code> typeclass for converting <code class="highlighter-rouge">F[A]</code> into a <code class="highlighter-rouge">Source[A, NotUsed]</code>. AckCord provides instances of this type for <code class="highlighter-rouge">Id</code> and <code class="highlighter-rouge">Future</code>, but if you’re dealing with something else, you’ll have to write the typeclass instance yourself.</p>

<h2 id="cores-cache">Core’s Cache</h2>

<p>If you depend on Core (you most likely do). Then the most common type of snapshot you will encounter is <code class="highlighter-rouge">MemoryCacheSnapshot</code> which is a <code class="highlighter-rouge">CacheSnapshot[Id]</code>. You will also encounter a <code class="highlighter-rouge">CacheState</code> when listening to events. This type gives you access to two different snapshots. One for before the event happened, and one for after. Generally you want to use the one after.</p>

<h2 id="easy-access-to-the-cache">Easy access to the cache</h2>

<p>Often times when overriding methods, an implicit cache snapshot will already be present. In some cases when dealing with a function instead though, you may want to extract the cache snapshot as a different parameter to mark it implicit. That’s where the <code class="highlighter-rouge">withCache</code> method for the high level API, and <code class="highlighter-rouge">CmdFlow</code> and <code class="highlighter-rouge">ParsedCmdFlow</code> comes in for the low level API. Using these we can extract the current cache snapshot into a separate function, used like so for the high level API.</p>

<h3 id="example">Example</h3>

<p>As before we create out client as usual.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ackcord._</span>
<span class="k">import</span> <span class="nn">ackcord.data._</span>
<span class="k">val</span> <span class="n">token</span> <span class="k">=</span> <span class="s">"&lt;token&gt;"</span>
<span class="k">val</span> <span class="n">settings</span> <span class="k">=</span> <span class="nc">ClientSettings</span><span class="o">(</span><span class="n">token</span><span class="o">)</span>
<span class="k">import</span> <span class="nn">settings.executionContext</span>

<span class="k">val</span> <span class="n">futureClient</span> <span class="k">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">createClient</span><span class="o">()</span>
<span class="n">futureClient</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">client</span> <span class="k">=&gt;</span>
  <span class="c1">//client.login()
</span><span class="o">}</span>
</code></pre>
</div>

<p>Using the <code class="highlighter-rouge">withCache</code> method. (Note: <code class="highlighter-rouge">withCache</code>, type inference and IntelliJ don’t always play nice together)</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">futureClient</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">client</span> <span class="k">=&gt;</span>
  <span class="n">client</span><span class="o">.</span><span class="n">onEvent</span> <span class="o">{</span>
    <span class="n">client</span><span class="o">.</span><span class="n">withCache</span><span class="o">[</span><span class="kt">Id</span>, <span class="kt">APIMessage</span><span class="o">]</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">APIMessage</span><span class="o">.</span><span class="nc">Ready</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">"Now ready"</span><span class="o">)</span>
        <span class="k">case</span> <span class="k">_</span>                   <span class="k">=&gt;</span> 
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Ok course you could also create an instance of <code class="highlighter-rouge">EventHandler</code>, and register that instead.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">futureClient</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">client</span> <span class="k">=&gt;</span>
  <span class="n">client</span><span class="o">.</span><span class="n">registerHandler</span> <span class="o">{</span>
    <span class="k">new</span> <span class="nc">EventHandler</span><span class="o">[</span><span class="kt">Id</span>, <span class="kt">Id</span>, <span class="kt">APIMessage.Ready</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">override</span> <span class="k">def</span> <span class="n">handle</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">APIMessage.Ready</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">c</span><span class="k">:</span> <span class="kt">CacheSnapshot</span><span class="o">[</span><span class="kt">Id</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> 
        <span class="n">println</span><span class="o">(</span><span class="s">"Now ready"</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>As for the flows, I’ll get back to those when talking about commands.</p>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script src="/js/main.js"></script></body></html>